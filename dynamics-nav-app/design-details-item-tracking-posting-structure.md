---
title: "Сведения о проектировании — структура учета трассировки товаров"
description: "Узнайте, как использовать операции книги товаров как основной носитель номеров трассировки товара."
documentationcenter: 
author: SorenGP
ms.prod: dynamics-nav-2018
ms.topic: article
ms.devlang: na
ms.tgt_pltfrm: na
ms.workload: na
ms.search.keywords: design, item tracking, posting, inventory
ms.date: 07/01/2017
ms.author: sgroespe
ms.translationtype: HT
ms.sourcegitcommit: 4fefaef7380ac10836fcac404eea006f55d8556f
ms.openlocfilehash: f31c9da412b4411cc8b104e59d1255456d096794
ms.contentlocale: ru-ru
ms.lasthandoff: 10/16/2017

---
# <a name="design-details-item-tracking-posting-structure"></a>Сведения о проектировании: структура учета трассировки товаров
Для того чтобы скоординировать с функцией учета стоимости товаров и получить более простое и надежное решение, операции журнала товаров используются как основные носители номеров трассировки товаров.  
  
Номера трассировки товаров в объектах сети заказов и незаказанных сетевых единицах указываются в таблице T337 **Операция резервирования**. Номера трассировки товара, относящиеся к историческим данным, извлекаются непосредственно из операций книги товаров, связанных с данной транзакцией. Это означает, что операции журнала товаров отражают спецификацию трассировки товаров строки учтенного заказа.  
  
Окно **Строки трассировки товаров** извлекает информацию из T337 и операций журнала товаров и отображает их во временной таблице, **Спецификация трассировки** (T336). В таблице T336 также содержатся данные трассировки в окне **Строки трассировки товаров** для количеств трассировок товаров, по которым еще предстоит выставить счет.  
  
## <a name="one-to-many-relation"></a>Отношение "один-ко-многим"  
Таблица **Связь товарной операции**, которая используется для того, чтобы связать строку учтенного документа с точно соответствующей операцией книги товаров, состоит, в основном, из 2 элементов.  
  
* Указатель на учтенную строку документа, поле **Номер строки заказа** .  
* Номер операции, указывающий на операцию книги товаров, поле **Код товарной операции**.  
  
Функция существующего поля **Номер операции**, которое связывает операцию журнала товаров с учтенной строкой документа, обрабатывает стандартные одноуровневые отношения без номеров трассировки товаров в учтенной строке документа. Если существуют номера трассировки товара, поле **Номер операции** остается пустым, а отношениями один-ко-многим обрабатывается в таблице **Связь товарной операции**. Если учтенная строка документа содержит номера трассировки товара, но относится только к одной операции книги товаров, отношение определяется в поле **Номер операции**, и запись в таблице **Связь товарной операции** не создается.  
  
## <a name="codeunits-80-and-90"></a>Codeunit 80 и 90  
Чтобы разделить операции журнала товаров во время учета, код в модулях codeunit 80 и codeunit 90 заключается в циклы, выполняющие обход глобальных переменных временной записи. Этот код вызывает модуль codeunit 22 со строкой журнала товаров. Эти переменные инициализируются, если номера трассировки товаров существуют для строки документа. Для упрощения кода всегда используется эта циклическая структура Если для строки документа не существуют номера трассировки товара, вставляется одна запись, и цикл выполняется только один раз.  
  
## <a name="posting-the-item-journal"></a>Учет журнала товаров  
Номера трассировки товара переносятся в операциях резервирования, которые связаны с операцией книги товаров, и цикл выполняется с помощью номеров трассировки товара в модуле codeunit 22. Это принцип работает так же, когда строка журнала товаров используется неявно для учета заказа на покупку или заказа на продажу, как при использовании строки журнала товаров напрямую. Если журнал товаров используется напрямую, поле **ИД строки источника** указывает на саму строку журнала товаров.  
  
## <a name="code-unit-22"></a>Модуль 22  
Модули codeunit 80 и 90 создают цикл вызова codeunit 22 во время учета счета номеров трассировки товара и во время учета существующих расходных и приходных накладных.  
  
Во время учета количества номеров трассировки товаров модуль codeunit 22 извлекает номера трассировки товаров из операций в T337, относящихся к учету. Эти операции помещаются напрямую в строку журнала товаров.  
  
Codeunit 22 переходит по номерам трассировки товара и разделяет учет на соответствующие операции книги товаров, включающие номера трассировки товара. Информация о том, какие операции книги товаров создаются, возвращается в T337 с помощью временной записи T336, которая вызывается в ходе выполнения процедуры в модуле codeunit 22. Данная процедура вызывается, когда модуль codeunit 22 заканчивает выполнение, поскольку на данный момент объект codeunit 22 содержит информацию. Если временная запись T336 извлечена, модули codeunit 80 и 90 создают записи в таблице **Связь товарной операции**, чтобы связать созданные операции книги товаров со строкой созданной отгрузки или приходной накладной. Затем модули codeunit 80 и 90 преобразовывают временные записи T336 в фактические записи T336, связанные с данной строкой. Однако это преобразование выполняется, только если учтенная строка документа не удаляется, поскольку она учтена лишь частично.  
  
## <a name="see-also"></a>См. также  
[Сведения о проектировании: трассировка товара](design-details-item-tracking.md)   
[Сведения о проектировании: разработка трассировки товара](design-details-item-tracking-design.md)
